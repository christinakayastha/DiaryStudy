{"version":3,"sources":["../scripts/routing.js"],"names":["window","friendlyPix","Router","constructor","$","document","ready","auth","waitForAuth","then","pagesElements","splashLogin","location","pathname","page","pipe","displayPage","bind","loadUser","userId","userPage","showHomeFeed","feed","showGeneralFeed","clearFeed","clear","showPost","postId","post","loadPost","pageId","onlyAuthed","attributes","context","firebase","currentUser","show","setLinkAsActive","canonicalPath","each","index","element","id","fadeOut","hide","MaterialUtils","closeDrawer","scrollToTop","reloadPage","path","animate","scrollTop","funct","attribute","optContinue","next","params","Object","keys","length","removeClass","addClass","router"],"mappings":"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","file":"routing.js","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the pages/routing.\n */\nfriendlyPix.Router = class {\n\n  /**\n   * Initializes the Friendly Pix controller/router.\n   * @constructor\n   */\n  constructor() {\n    $(document).ready(() => {\n      friendlyPix.auth.waitForAuth.then(() => {\n        // Dom elements.\n        this.pagesElements = $('[id^=page-]');\n        this.splashLogin = $('#login', '#page-splash');\n\n        // Make sure /add is never opened on website load.\n        if (window.location.pathname === '/add') {\n          page('/');\n        }\n\n        // Configuring routes.\n        const pipe = friendlyPix.Router.pipe;\n        const displayPage = this.displayPage.bind(this);\n        const loadUser = userId => friendlyPix.userPage.loadUser(userId);\n        const showHomeFeed = () => friendlyPix.feed.showHomeFeed();\n        const showGeneralFeed = () => friendlyPix.feed.showGeneralFeed();\n        const clearFeed = () => friendlyPix.feed.clear();\n        const showPost = postId => friendlyPix.post.loadPost(postId);\n\n        page('/', pipe(showHomeFeed, null, true),\n            pipe(displayPage, {pageId: 'feed', onlyAuthed: true}));\n        page('/feed', pipe(showGeneralFeed, null, true), pipe(displayPage, {pageId: 'feed'}));\n        page('/post/:postId', pipe(showPost, null, true), pipe(displayPage, {pageId: 'post'}));\n        page('/user/:userId', pipe(loadUser, null, true), pipe(displayPage, {pageId: 'user-info'}));\n        page('/about', pipe(clearFeed, null, true), pipe(displayPage, {pageId: 'about'}));\n        page('/add', pipe(displayPage, {pageId: 'add', onlyAuthed: true}));\n        page('*', () => page('/'));\n\n        // Start routing.\n        page();\n      });\n    });\n  }\n\n  /**\n   * Returns a function that displays the given page and hides the other ones.\n   * if `onlyAuthed` is set to true then the splash page will be displayed instead of the page if\n   * the user is not signed-in.\n   */\n  displayPage(attributes, context) {\n    const onlyAuthed = attributes.onlyAuthed;\n    let pageId = attributes.pageId;\n\n    if (onlyAuthed && !firebase.auth().currentUser) {\n      pageId = 'splash';\n      this.splashLogin.show();\n    }\n    friendlyPix.Router.setLinkAsActive(context.canonicalPath);\n    this.pagesElements.each(function(index, element) {\n      if (element.id === 'page-' + pageId) {\n        $(element).show();\n      } else if (element.id === 'page-splash') {\n        $(element).fadeOut(1000);\n      } else {\n        $(element).hide();\n      }\n    });\n    friendlyPix.MaterialUtils.closeDrawer();\n    friendlyPix.Router.scrollToTop();\n  }\n\n  /**\n   * Reloads the current page.\n   */\n  reloadPage() {\n    let path = window.location.pathname;\n    if (path === '') {\n      path = '/';\n    }\n    page(path);\n  }\n\n  /**\n   * Scrolls the page to top.\n   */\n  static scrollToTop() {\n    $('html,body').animate({scrollTop: 0}, 0);\n  }\n\n  /**\n   * Pipes the given function and passes the given attribute and Page.js context.\n   * Set 'optContinue' to true if there are further functions to call.\n   */\n  static pipe(funct, attribute, optContinue) {\n    return (context, next) => {\n      if (funct) {\n        const params = Object.keys(context.params);\n        if (!attribute && params.length > 0) {\n          funct(context.params[params[0]], context);\n        } else {\n          funct(attribute, context);\n        }\n      }\n      if (optContinue) {\n        next();\n      }\n    };\n  }\n\n  /**\n   * Highlights the correct menu item/link.\n   */\n  static setLinkAsActive(canonicalPath) {\n    if (canonicalPath === '') {\n      canonicalPath = '/';\n    }\n    $('.is-active').removeClass('is-active');\n    $(`[href=\"${canonicalPath}\"]`).addClass('is-active');\n  }\n};\n\nfriendlyPix.router = new friendlyPix.Router();\n"]}