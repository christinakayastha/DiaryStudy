{"version":3,"sources":["../scripts/auth.js"],"names":["window","friendlyPix","Auth","waitForAuth","_waitForAuthPromiseResolver","promise","constructor","database","firebase","auth","$","Deferred","document","ready","signedInUserContainer","signedInUserAvatar","signedInUsername","signOutButton","signedOutOnlyElements","signedInOnlyElements","usernameLink","click","signOut","hide","onAuthStateChanged","user","userId","uid","router","reloadPage","resolve","show","css","firebaseUi","start","uiConfig","photoURL","text","displayName","attr","saveUserData"],"mappings":"AAAA;;;;;;;;;;;;;;;AAeA;;AAEAA,OAAOC,WAAP,GAAqBD,OAAOC,WAAP,IAAsB,EAA3C;;AAEA;;;AAGAA,YAAYC,IAAZ,GAAmB,MAAM;;AAEvB;;;;AAIA,MAAIC,WAAJ,GAAkB;AAChB,WAAO,KAAKC,2BAAL,CAAiCC,OAAjC,EAAP;AACD;;AAED;;;;;AAKAC,gBAAc;AACZ;AACA,SAAKC,QAAL,GAAgBC,SAASD,QAAT,EAAhB;AACA,SAAKE,IAAL,GAAYD,SAASC,IAAT,EAAZ;AACA,SAAKL,2BAAL,GAAmC,IAAIM,EAAEC,QAAN,EAAnC;;AAEAD,MAAEE,QAAF,EAAYC,KAAZ,CAAkB,MAAM;AACtB;AACA,YAAMC,wBAAwBJ,EAAE,8BAAF,CAA9B;AACA,WAAKK,kBAAL,GAA0BL,EAAE,YAAF,EAAgBI,qBAAhB,CAA1B;AACA,WAAKE,gBAAL,GAAwBN,EAAE,cAAF,EAAkBI,qBAAlB,CAAxB;AACA,WAAKG,aAAL,GAAqBP,EAAE,cAAF,CAArB;AACA,WAAKQ,qBAAL,GAA6BR,EAAE,qBAAF,CAA7B;AACA,WAAKS,oBAAL,GAA4BT,EAAE,oBAAF,CAA5B;AACA,WAAKU,YAAL,GAAoBV,EAAE,kBAAF,CAApB;;AAEA;AACA,WAAKO,aAAL,CAAmBI,KAAnB,CAAyB,MAAM,KAAKZ,IAAL,CAAUa,OAAV,EAA/B;AACA,WAAKH,oBAAL,CAA0BI,IAA1B;AACD,KAbD;;AAeA,SAAKd,IAAL,CAAUe,kBAAV,CAA6BC,QAAQ,KAAKD,kBAAL,CAAwBC,IAAxB,CAArC;AACD;;AAED;;;;AAIAD,qBAAmBC,IAAnB,EAAyB;AACvB;AACA,QAAIA,QAAQ,KAAKC,MAAL,KAAgBD,KAAKE,GAAjC,EAAsC;AACpC;AACD;;AAED,QAAI3B,OAAOC,WAAP,CAAmB2B,MAAvB,EAA+B;AAC7B5B,aAAOC,WAAP,CAAmB2B,MAAnB,CAA0BC,UAA1B;AACD;AACD,SAAKzB,2BAAL,CAAiC0B,OAAjC;AACApB,MAAEE,QAAF,EAAYC,KAAZ,CAAkB,MAAM;AACtB,UAAI,CAACY,IAAL,EAAW;AACT,aAAKP,qBAAL,CAA2Ba,IAA3B;AACA,aAAKZ,oBAAL,CAA0BI,IAA1B;AACA,aAAKG,MAAL,GAAc,IAAd;AACA,aAAKX,kBAAL,CAAwBiB,GAAxB,CAA4B,kBAA5B,EAAgD,EAAhD;AACAC,mBAAWC,KAAX,CAAiB,4BAAjB,EAA+CC,QAA/C;AACD,OAND,MAMO;AACL,aAAKjB,qBAAL,CAA2BK,IAA3B;AACA,aAAKJ,oBAAL,CAA0BY,IAA1B;AACA,aAAKL,MAAL,GAAcD,KAAKE,GAAnB;AACA,aAAKZ,kBAAL,CAAwBiB,GAAxB,CAA4B,kBAA5B;AACK,iBAAOP,KAAKW,QAAL,IAAiB,wBAAyB,KADtD;AAEA,aAAKpB,gBAAL,CAAsBqB,IAAtB,CAA2BZ,KAAKa,WAAL,IAAoB,WAA/C;AACA,aAAKlB,YAAL,CAAkBmB,IAAlB,CAAuB,MAAvB,EAAgC,UAAQd,KAAKE,GAAI,GAAjD;AACA1B,oBAAYO,QAAZ,CAAqBgC,YAArB,CAAkCf,KAAKW,QAAvC,EAAiDX,KAAKa,WAAtD;AACD;AACF,KAjBD;AAkBD,GAvEsB,CAAzB;;;AA0EArC,YAAYQ,IAAZ,GAAmB,IAAIR,YAAYC,IAAhB,EAAnB","file":"auth.js","sourcesContent":["/**\n * Copyright 2015 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n'use strict';\n\nwindow.friendlyPix = window.friendlyPix || {};\n\n/**\n * Handles the user auth flows and updating the UI depending on the auth state.\n */\nfriendlyPix.Auth = class {\n\n  /**\n   * Returns a Promise that completes when auth is ready.\n   * @return Promise\n   */\n  get waitForAuth() {\n    return this._waitForAuthPromiseResolver.promise();\n  }\n\n  /**\n   * Initializes Friendly Pix's auth.\n   * Binds the auth related UI components and handles the auth flow.\n   * @constructor\n   */\n  constructor() {\n    // Firebase SDK\n    this.database = firebase.database();\n    this.auth = firebase.auth();\n    this._waitForAuthPromiseResolver = new $.Deferred();\n\n    $(document).ready(() => {\n      // Pointers to DOM Elements\n      const signedInUserContainer = $('.fp-signed-in-user-container');\n      this.signedInUserAvatar = $('.fp-avatar', signedInUserContainer);\n      this.signedInUsername = $('.fp-username', signedInUserContainer);\n      this.signOutButton = $('.fp-sign-out');\n      this.signedOutOnlyElements = $('.fp-signed-out-only');\n      this.signedInOnlyElements = $('.fp-signed-in-only');\n      this.usernameLink = $('.fp-usernamelink');\n\n      // Event bindings\n      this.signOutButton.click(() => this.auth.signOut());\n      this.signedInOnlyElements.hide();\n    });\n\n    this.auth.onAuthStateChanged(user => this.onAuthStateChanged(user));\n  }\n\n  /**\n   * Displays the signed-in user information in the UI or hides it and displays the\n   * \"Sign-In\" button if the user isn't signed-in.\n   */\n  onAuthStateChanged(user) {\n    // We ignore token refresh events.\n    if (user && this.userId === user.uid) {\n      return;\n    }\n\n    if (window.friendlyPix.router) {\n      window.friendlyPix.router.reloadPage();\n    }\n    this._waitForAuthPromiseResolver.resolve();\n    $(document).ready(() => {\n      if (!user) {\n        this.signedOutOnlyElements.show();\n        this.signedInOnlyElements.hide();\n        this.userId = null;\n        this.signedInUserAvatar.css('background-image', '');\n        firebaseUi.start('#firebaseui-auth-container', uiConfig);\n      } else {\n        this.signedOutOnlyElements.hide();\n        this.signedInOnlyElements.show();\n        this.userId = user.uid;\n        this.signedInUserAvatar.css('background-image',\n            `url(\"${user.photoURL || '/images/silhouette.jpg'}\")`);\n        this.signedInUsername.text(user.displayName || 'Anonymous');\n        this.usernameLink.attr('href', `/user/${user.uid}`);\n        friendlyPix.firebase.saveUserData(user.photoURL, user.displayName);\n      }\n    });\n  }\n};\n\nfriendlyPix.auth = new friendlyPix.Auth();\n"]}